<form
  (ngSubmit)="onSubmit(projectFormControl.value)"
  *ngIf="projectFormControl"
  [formGroup]="projectFormControl"
  class="row"
  novalidate
>
  <mat-dialog-content cdkScrollable>
    <div class="project-editor-form">
      <mat-form-field>
        <mat-label>Bezeichnung</mat-label>
        <input
          [formControl]="projectFormControl.controls['name']"
          matInput
          maxlength="255"
          placeholder="Bezeichnung"
          required
        />

        <mat-hint align="end">
          {{ projectFormControl.controls['name'].value?.length || 0 }}/255
        </mat-hint>

        <mat-error
          *ngIf="projectFormControl.controls['name'].hasError('required')"
        >
          Bezeichnung <strong>fehlt</strong>!
        </mat-error>
        <mat-error
          *ngIf="projectFormControl.controls['name'].hasError('pattern')"
        >
          Bezeichnung enthält ungültige Zeichen.
        </mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Kurzbeschreibung</mat-label>
        <textarea
          [formControl]="projectFormControl.controls['shortDescription']"
          class="form-textarea"
          matInput
          maxlength="10000"
          placeholder="Kurzbeschreibung"
          required
        ></textarea>

        <mat-hint align="end">
          {{
            projectFormControl.controls['shortDescription'].value?.length || 0
          }}/10000
        </mat-hint>

        <mat-error
          *ngIf="
            projectFormControl.controls['shortDescription'].hasError('required')
          "
        >
          Kurzbeschreibung <strong>fehlt</strong>!
        </mat-error>
        <mat-error
          *ngIf="
            projectFormControl.controls['shortDescription'].hasError('pattern')
          "
        >
          Kurzbeschreibung enthält ungültige Zeichen.
        </mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Voraussetzungen</mat-label>
        <textarea
          [formControl]="projectFormControl.controls['requirement']"
          class="form-textarea"
          matInput
          maxlength="10000"
          placeholder="Teilnahmevoraussetzungen"
        ></textarea>

        <mat-hint align="end">
          {{
            projectFormControl.controls['requirement'].value?.length || 0
          }}/10000
        </mat-hint>
        <mat-error
          *ngIf="projectFormControl.controls['requirement'].hasError('pattern')"
        >
          Teilnahmevoraussetzungen enthält ungültige Zeichen.
        </mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Beschreibung</mat-label>
        <textarea
          [formControl]="projectFormControl.controls['description']"
          class="form-textarea"
          matInput
          placeholder="Beschreibung"
          maxlength="10000"
        ></textarea>

        <mat-hint align="end">
          {{
            projectFormControl.controls['description'].value?.length || 0
          }}/10000
        </mat-hint>
        <mat-error
          *ngIf="projectFormControl.controls['description'].hasError('pattern')"
        >
          Beschreibung enthält ungültige Zeichen.
        </mat-error>
      </mat-form-field>

      <mat-form-field *ngIf="isProfessor">
        <mat-label>Betreuer</mat-label>
        <input
          [formControl]="projectFormControl.controls['supervisorName']"
          matInput
          required
          maxlength="255"
        />
        <mat-hint align="end">
          {{ projectFormControl.controls['supervisorName'].value.length }}/255
        </mat-hint>
        <mat-error
          *ngIf="
            projectFormControl.controls['supervisorName'].hasError('pattern')
          "
        >
          Betreuungsperson enthält ungültige Zeichen.
        </mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Status</mat-label>
        <mat-select
          [formControl]="projectFormControl.controls['status']"
          placeholder="Status"
          required
        >
          <!-- The following options should be implemented either as enums or imported from backend -->
          <mat-option value="VERFÜGBAR">Verfügbar</mat-option>

          <mat-option value="LAUFEND">Laufend</mat-option>

          <mat-option value="ABGESCHLOSSEN">Abgeschlossen</mat-option>
        </mat-select>

        <mat-error
          *ngIf="projectFormControl.controls['status'].hasError('required')"
        >
          Status <strong>fehlt</strong>!
        </mat-error>
      </mat-form-field>

      <div>
        <mat-expansion-panel class="mat-elevation-z0">
          <mat-expansion-panel-header>
            <mat-panel-title>Studiengänge</mat-panel-title>
            <mat-panel-description
              >An- und Abwählen von Studiengängen zum Filtern der
              Modularten</mat-panel-description
            >
          </mat-expansion-panel-header>
          <ul class="studyProgramsList">
            <li *ngFor="let studyProgram of studyPrograms">
              <mat-slide-toggle
                [checked]="studyProgramSelection.isSelected(studyProgram)"
                (change)="toggleStudyProgram($event, studyProgram)"
              >
                {{ studyProgram.name }}</mat-slide-toggle
              >
            </li>
          </ul>
        </mat-expansion-panel>

        <table
          mat-table
          matSort
          matSortActive="name"
          matSortDirection="asc"
          [dataSource]="dataSource"
          class="mat-elevation-z0 moduleTable"
        >
          <!-- Checkbox Column -->
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>Auswahl</th>
            <td mat-cell *matCellDef="let element">
              <mat-checkbox [checked]="moduleSelection.isSelected(element)">
              </mat-checkbox>
            </td>
          </ng-container>
          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
            <td mat-cell *matCellDef="let element">
              {{ element.name }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let element; columns: displayedColumns"
            (click)="selectModule(element)"
          ></tr>
        </table>
      </div>

      <mat-form-field class="tag-list">
        <mat-label>Tags</mat-label>
        <mat-chip-list #tagList>
          <mat-chip
            *ngFor="let tag of tags"
            [removable]="true"
            (removed)="removeTag(tag)"
          >
            {{ tag.tagName }}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>

          <mat-chip
            *ngFor="let tag of recommendedTags"
            (selectionChange)="recommendedTagSelected(tag, $event)"
            (click)="addRecommendedTag(tag)"
            class="recommended-tag"
          >
            {{ tag.tagName }}
          </mat-chip>

          <input
            #tagInput
            [formControl]="projectFormControl.controls['tagInput']"
            placeholder="Tags"
            [matAutocomplete]="tagAuto"
            [matChipInputFor]="tagList"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            (matChipInputTokenEnd)="addTagEvent($event)"
          />
        </mat-chip-list>

        <mat-autocomplete
          #tagAuto="matAutocomplete"
          (optionSelected)="selectedTag($event)"
        >
          <mat-option *ngFor="let tag of filteredTags | async" [value]="tag">
            {{ tag.tagName }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </div>
  </mat-dialog-content>

  <div mat-dialog-actions>
    <div class="action-buttons">
      <button
        (click)="cancelButtonClicked()"
        mat-button
        type="reset"
        color="warn"
      >
        Abbrechen
      </button>

      <button
        [disabled]="projectFormControl.invalid || hasSubmitted"
        mat-button
        color="primary"
        type="submit"
      >
        {{ project ? 'Änderungen speichern' : 'Hinzufügen' }}
      </button>
    </div>
  </div>
</form>
