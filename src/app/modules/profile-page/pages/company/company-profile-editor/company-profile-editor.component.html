<div>
  <div
    fxLayout="column"
    fxLayoutAlign="space-around center"
    *ngIf="hasPermission"
  >
    <mat-card class="card">
      <mat-card-title>Unternehmensprofil bearbeiten</mat-card-title>
      <mat-card-content>
        <form [formGroup]="profileForm">
          <h3>Informationen</h3>
          <div
            gdAreas="picture mainInfo | info info"
            gdRows="auto auto"
            gdColumns="25% 73%"
            gdGap="2%"
            gdAreas.lt-md="picture | mainInfo | info"
            gdColumns.lt-md="auto"
            gdRows.lt-md="auto auto auto"
          >
            <div gdArea="picture">
              <div class="profileImageContainer">
                <img
                  class="profileImage"
                  alt="Profile Image"
                  [src]="imageSrc"
                  onerror="this.src='/assets/images/blank-profile-picture.png'"
                />
              </div>

              <button mat-raised-button (click)="deleteProfileImage()">
                <mat-icon>close</mat-icon> Profilbild entfernen
              </button>
              <button mat-raised-button (click)="fileInput.click()">
                <mat-icon>publish</mat-icon> Profilbild hochladen
                <input
                  #fileInput
                  style="display: none"
                  type="file"
                  id="file"
                  accept="image/jpeg, image/png, image/gif"
                  (change)="uploadImage($event.target.files)"
                />
              </button>
            </div>
            <div gdArea="mainInfo">
              <div fxLayout="column">
                <mat-form-field appearance="fill">
                  <mat-label>Name</mat-label>
                  <input
                    matInput
                    formControlName="name"
                    maxlength="255"
                    required
                  />
                </mat-form-field>
                <mat-form-field
                  appearance="fill"
                  fxFlex="49"
                  fxFlex.lt-md="100"
                >
                  <mat-label>Mitarbeiteranzahl</mat-label>
                  <input
                    matInput
                    formControlName="numberOfEmployees"
                    maxlength="255"
                  />
                </mat-form-field>
                <mat-form-field
                  appearance="fill"
                  fxFlex="49"
                  fxFlex.lt-md="100"
                >
                  <mat-label>Hauptsitz</mat-label>
                  <input
                    matInput
                    formControlName="headquarter"
                    maxlength="255"
                  />
                </mat-form-field>
                <mat-form-field
                  appearance="fill"
                  fxFlex="49"
                  fxFlex.lt-md="100"
                >
                  <mat-label>Homepage</mat-label>
                  <input matInput formControlName="homepage" maxlength="255" />
                </mat-form-field>
                <mat-form-field
                  appearance="fill"
                  fxFlex="49"
                  fxFlex.lt-md="100"
                >
                  <mat-label>Gründungsdatum</mat-label>
                  <input
                    matInput
                    formControlName="foundation"
                    maxlength="255"
                  />
                </mat-form-field>
              </div>
            </div>
            <div
              gdArea="info"
              fxLayout="row wrap"
              fxLayoutAlign="center center"
              fxLayoutGap="1%"
            ></div>
          </div>
          <br />
          <mat-divider></mat-divider>
          <div formGroupName="socialMedia" class="socialMedia">
            <h3>Social Media Links</h3>
            <b>
              Derzeit ist es zwingend nötig, dass Sie die Accountkennung
              angeben.
            </b>
            <p class="valid-example">✔️ Richtig: <i>MusterfirmaGmbH</i></p>
            <p class="invalid-example">
              ❌ Falsch: <i>https://www.facebook.com/MusterfirmaGmbH/</i>
            </p>
            <div fxLayout="column">
              <mat-form-field
                appearance="fill"
                *ngFor="let platform of socialMediaPlatforms"
              >
                <mat-label>{{ platform[3] }}</mat-label>
                <mat-icon
                  fontSet="fab"
                  [fontIcon]="platform[2]"
                  matPrefix
                ></mat-icon>
                <input
                  matInput
                  [formControlName]="platform[0]"
                  maxlength="255"
                />
              </mat-form-field>
            </div>
          </div>
          <mat-divider></mat-divider>
          <br />
          <div>
            <h3>Weitere Standorte</h3>
            <mat-form-field class="quarters-chip-list">
              <mat-chip-list #quartersChipList>
                <mat-chip
                  *ngFor="let quarter of quarters"
                  [removable]="true"
                  (removed)="removeQuarter(quarter)"
                >
                  {{ quarter.location }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>

                <input
                  #branchesInput
                  placeholder="Standorte"
                  [matChipInputFor]="quartersChipList"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                  [matChipInputAddOnBlur]="true"
                  (matChipInputTokenEnd)="addQuarter($event)"
                  maxlength="255"
                />
              </mat-chip-list>
            </mat-form-field>
          </div>
          <br />
          <mat-divider></mat-divider>
          <br />
          <div>
            <h3>Branchen</h3>
            <mat-form-field class="branches-chip-list">
              <mat-chip-list #branchesChipList>
                <mat-chip
                  *ngFor="let branch of branches"
                  [removable]="true"
                  (removed)="removeBranch(branch)"
                >
                  {{ branch.branchName }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>

                <input
                  #branchesInput
                  placeholder="Branchen"
                  [matChipInputFor]="branchesChipList"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                  [matChipInputAddOnBlur]="true"
                  (matChipInputTokenEnd)="addBranch($event)"
                  maxlength="255"
                />
              </mat-chip-list>
            </mat-form-field>
          </div>
          <br />
          <mat-divider></mat-divider>
          <div>
            <h3>Sprachen im Unternehmen</h3>
            <mat-form-field class="languages-chip-list">
              <mat-chip-list #languagesChipList>
                <mat-chip
                  *ngFor="let language of languages"
                  [removable]="true"
                  (removed)="removeLanguage(language)"
                >
                  {{ language.germanName }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>

                <input
                  #languageInput
                  placeholder="Sprachen"
                  [formControl]="languageCtrl"
                  [matChipInputFor]="languagesChipList"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                  [matAutocomplete]="auto"
                  maxlength="255"
                />
              </mat-chip-list>
              <mat-autocomplete
                #auto="matAutocomplete"
                (optionSelected)="selected($event)"
              >
                <mat-option
                  *ngFor="let language of filteredLanguages | async"
                  [value]="language"
                >
                  <span
                    [ngClass]="
                      language.iso3166Mapping
                        ? 'flag-icon-' + language.iso3166Mapping
                        : 'placeholder-flag'
                    "
                    class="flag-icon"
                  ></span>
                  {{ language.germanName }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>
          <br />
          <mat-divider></mat-divider>
          <br />
          <div>
            <h3>Unternehmensbeschreibung</h3>
            <mat-form-field appearance="fill">
              <textarea
                matInput
                cdkTextareaAutosize
                cdkAutosizeMinRows="5"
                cdkAutosizeMaxRows="20"
                formControlName="vita"
              ></textarea>
            </mat-form-field>
          </div>
          <br />
          <mat-divider></mat-divider>
          <br />
          <div class="buttonContainer">
            <button
              class="saveButton"
              mat-raised-button
              color="primary"
              (click)="onSubmit()"
              type="submit"
              [disabled]="this.profileForm.invalid"
            >
              <mat-icon>save</mat-icon> Speichern
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
    <br />
  </div>
  <div
    fxLayout="column"
    fxLayoutAlign="space-around center"
    *ngIf="!hasPermission"
  >
    Sie haben keine Berechtigung für diese Seite.
  </div>
</div>
